<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Exam Results</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container" style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">
    <div class="card fade-in" style="max-width: 500px; width: 100%;">
      <div class="text-center mb-4">
        <h2>üìÑ Your Exam Results</h2>
        <p style="color: #718096;">Check your academic performance</p>
      </div>

      <div class="form-group">
        <input type="number" id="studentId" placeholder="üÜî Enter your Student ID" class="form-control">
      </div>
      
      <button id="checkBtn" class="btn btn-primary btn-block">
        üîç Check My Results
      </button>

      <div id="marksList" class="mt-4"></div>

      <div class="text-center mt-4">
        <button class="btn btn-secondary" onclick="goBack()">‚¨Ö Back to Dashboard</button>
      </div>
    </div>
  </div>

  <script>
    document.getElementById("checkBtn").addEventListener("click", loadMarksById);

    function loadMarksById() {
      const id = document.getElementById("studentId").value.trim();
      const resultsDiv = document.getElementById("marksList");
      
      if (!id) { 
        resultsDiv.innerHTML = '<div class="alert alert-error">Please enter your Student ID</div>';
        return; 
      }

      // Show loading state
      resultsDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading your results...</p></div>';

      fetch(`http://localhost:8081/student/${id}/marks`)
        .then(response => {
          if (!response.ok) throw new Error("No marks found for given ID (status " + response.status + ")");
          return response.json();
        })
        .then(data => {
          if (Array.isArray(data) && data.length > 0) {
            let html = '<div class="card" style="margin-top: 20px;"><h3 style="color: #2d3748; margin-bottom: 20px;">üìä Your Academic Results</h3>';
            html += '<div class="grid grid-1" style="gap: 15px;">';
            
            data.forEach(mark => {
              const percentage = mark.marks ? ((mark.marks / 100) * 100).toFixed(1) : 'N/A';
              const gradeColor = mark.marks >= 80 ? '#38a169' : mark.marks >= 60 ? '#d69e2e' : '#e53e3e';
              
              html += `
                <div class="card" style="padding: 15px; border-left: 4px solid ${gradeColor};">
                  <div class="grid grid-2 align-center">
                    <div>
                      <h4 style="margin: 0; color: #2d3748;">${mark.subject || "N/A"}</h4>
                      <p style="margin: 5px 0; color: #718096;">Student: ${mark.studentName}</p>
                    </div>
                    <div class="text-right">
                      <span style="font-size: 1.5rem; font-weight: 700; color: ${gradeColor};">${mark.marks}/100</span>
                      <p style="margin: 0; color: #718096; font-size: 0.9rem;">${percentage}%</p>
                    </div>
                  </div>
                </div>
              `;
            });
            
            html += '</div></div>';
            resultsDiv.innerHTML = html;
          } else {
            resultsDiv.innerHTML = '<div class="alert alert-info">üìö No exam results found for this student ID.</div>';
          }
        })
        .catch(err => {
          resultsDiv.innerHTML = `<div class="alert alert-error">‚ùå ${err.message}</div>`;
        });
    }

    function goBack() {
      window.location.href = "student.html";
    }

    // Auto-load if student ID is in session storage
    window.addEventListener('load', function() {
      const studentId = sessionStorage.getItem('studentId');
      if (studentId) {
        document.getElementById('studentId').value = studentId;
        loadMarksById();
      }
    });
  </script>
</body>
</html>
