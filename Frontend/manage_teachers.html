<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Teachers</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="fade-in">
      <!-- Header -->
      <div class="nav">
        <div class="nav-brand">ğŸ‘©â€ğŸ« Manage Teachers</div>
        <div class="nav-links">
          <button onclick="loadTeachers()" class="btn btn-info">ğŸ”„ Refresh</button>
          <button onclick="showAddForm()" class="btn btn-success">â• Add Teacher</button>
          <a href="admin_dashboard.html" class="btn btn-secondary">â¬… Dashboard</a>
        </div>
      </div>

      <!-- Add Teacher Form (Hidden by default) -->
      <div id="addTeacherForm" class="card hidden slide-up">
        <h2>â• Add New Teacher</h2>
        <div class="grid grid-2">
          <div class="form-group">
            <input type="text" id="teacherName" placeholder="ğŸ‘¤ Full Name" class="form-control">
          </div>
          <div class="form-group">
            <input type="email" id="teacherEmail" placeholder="ğŸ“§ Email Address" class="form-control">
          </div>
          <div class="form-group">
            <input type="text" id="teacherDepartment" placeholder="ğŸ¢ Department" class="form-control">
          </div>
          <div class="form-group">
            <input type="text" id="teacherId" placeholder="ğŸ†” Teacher ID" class="form-control">
          </div>
        </div>
        <div class="form-group">
          <input type="password" id="teacherPassword" placeholder="ğŸ”’ Password" class="form-control">
        </div>
        
        <div class="grid grid-2" style="gap: 15px;">
          <button onclick="addTeacher()" class="btn btn-success">âœ… Add Teacher</button>
          <button onclick="hideAddForm()" class="btn btn-danger">âŒ Cancel</button>
        </div>
        
        <div id="addMessage" class="mt-3"></div>
      </div>

      <!-- Teachers List -->
      <div class="card">
        <h2>ğŸ“‹ Teacher Directory</h2>
        <div id="teachersList">
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading teachers...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load teachers on page load
    window.onload = function() {
      loadTeachers();
    };

    function loadTeachers() {
      const container = document.getElementById('teachersList');
      container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading teachers...</p></div>';

      fetch('http://localhost:8081/admin/list-teachers')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return response.json();
        })
        .then(teachers => {
          displayTeachers(teachers);
        })
        .catch(error => {
          console.error('Error loading teachers:', error);
          container.innerHTML = `
            <div class="text-center p-4">
              <div class="alert alert-warning">
                <h3>âš ï¸ No teachers available to manage</h3>
                <p>This could be because:</p>
                <ul style="text-align: left; margin: 15px 0;">
                  <li>â€¢ No teachers have been added to the system yet</li>
                  <li>â€¢ Only admins can add teachers (teachers cannot self-register)</li>
                  <li>â€¢ Database connection issue: ${error.message}</li>
                </ul>
                <div class="grid grid-2" style="gap: 15px; margin-top: 20px;">
                  <button onclick="loadTeachers()" class="btn btn-info">ğŸ”„ Try Again</button>
                  <button onclick="showAddForm()" class="btn btn-success">â• Add First Teacher</button>
                </div>
              </div>
            </div>
          `;
        });
    }

    function displayTeachers(teachers) {
      const container = document.getElementById('teachersList');
      
      if (!teachers || teachers.length === 0) {
        container.innerHTML = `
          <div class="text-center p-4">
            <div class="alert alert-info">
              <h3>ğŸ‘©â€ğŸ« No teachers found</h3>
              <p>Teachers must be added by administrators.</p>
              <button onclick="showAddForm()" class="btn btn-success mt-3">â• Add First Teacher</button>
            </div>
          </div>
        `;
        return;
      }

      let html = '<div class="grid grid-1" style="gap: 20px;">';
      teachers.forEach(teacher => {
        html += `
          <div class="card" style="padding: 20px;">
            <div class="grid grid-2 align-center">
              <div>
                <h3 style="margin-bottom: 10px; color: #2d3748;">${teacher.name || 'N/A'}</h3>
                <p style="color: #718096; margin: 5px 0;">ğŸ“§ ${teacher.email || 'N/A'}</p>
                <p style="color: #718096; margin: 5px 0;">ğŸ¢ ${teacher.department || 'N/A'}</p>
                <p style="color: #718096; margin: 5px 0;">ğŸ†” ID: ${teacher.id}</p>
              </div>
              <div class="text-right">
                <div class="grid grid-1" style="gap: 10px;">
                  <button onclick="editTeacher(${teacher.id})" class="btn btn-warning">âœï¸ Edit</button>
                  <button onclick="deleteTeacher(${teacher.id}, '${teacher.name || 'Teacher'}')" class="btn btn-danger">ğŸ—‘ï¸ Delete</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      container.innerHTML = html;
    }

    function showAddForm() {
      document.getElementById('addTeacherForm').classList.remove('hidden');
      document.getElementById('addTeacherForm').scrollIntoView({ behavior: 'smooth' });
    }

    function hideAddForm() {
      document.getElementById('addTeacherForm').classList.add('hidden');
      clearAddForm();
    }

    function clearAddForm() {
      document.getElementById('teacherName').value = '';
      document.getElementById('teacherEmail').value = '';
      document.getElementById('teacherDepartment').value = '';
      document.getElementById('teacherId').value = '';
      document.getElementById('teacherPassword').value = '';
      document.getElementById('addMessage').innerHTML = '';
    }

    function addTeacher() {
      const data = {
        name: document.getElementById('teacherName').value,
        email: document.getElementById('teacherEmail').value,
        department: document.getElementById('teacherDepartment').value,
        teacherId: document.getElementById('teacherId').value,
        password: document.getElementById('teacherPassword').value
      };

      const messageDiv = document.getElementById('addMessage');

      if (!data.name || !data.email || !data.password) {
        messageDiv.innerHTML = '<div class="alert alert-error">Please fill in all required fields</div>';
        return;
      }

      messageDiv.innerHTML = '<div class="alert alert-info">ğŸ”„ Adding teacher...</div>';

      fetch('http://localhost:8081/admin/add-teacher', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(response => response.text())
      .then(result => {
        if (result.includes('successfully')) {
          messageDiv.innerHTML = '<div class="alert alert-success">âœ… ' + result + '</div>';
          clearAddForm();
          loadTeachers(); // Refresh the list
          setTimeout(hideAddForm, 2000); // Hide form after 2 seconds
        } else {
          messageDiv.innerHTML = '<div class="alert alert-error">âŒ ' + result + '</div>';
        }
      })
      .catch(error => {
        messageDiv.innerHTML = '<div class="alert alert-error">âŒ Error: ' + error.message + '</div>';
      });
    }

    function deleteTeacher(id, name) {
      if (confirm(`Are you sure you want to delete teacher "${name}"?`)) {
        fetch(`http://localhost:8081/admin/delete-teacher/${id}`, {
          method: 'DELETE'
        })
        .then(response => response.text())
        .then(result => {
          alert('âœ… ' + result);
          loadTeachers(); // Refresh the list
        })
        .catch(error => {
          alert('âŒ Error deleting teacher: ' + error.message);
        });
      }
    }

    function editTeacher(id) {
      alert('âœï¸ Edit functionality will be implemented soon!');
    }
  </script>
</body>
</html>