<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Attendance</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container" style="display: flex; align-items: center; justify-content: center; min-height: 100vh;">
    <div class="card fade-in" style="max-width: 500px; width: 100%;">
      <div class="text-center mb-4">
        <h2>ğŸ“Š Your Attendance</h2>
        <p style="color: #718096;">Track your class attendance</p>
      </div>

      <div class="form-group">
        <input type="number" id="studentId" placeholder="ğŸ†” Enter your Student ID" class="form-control">
      </div>
      
      <button onclick="loadAttendanceById()" class="btn btn-success btn-block">
        ğŸ“ˆ Check My Attendance
      </button>

      <div id="attendance" class="mt-4"></div>

      <div class="text-center mt-4">
        <button class="btn btn-secondary" onclick="goBack()">â¬… Back to Dashboard</button>
      </div>
    </div>
  </div>

  <script>
    function loadAttendanceById() {
      const id = document.getElementById("studentId").value.trim();
      const attendanceDiv = document.getElementById("attendance");
      
      if (!id) { 
        attendanceDiv.innerHTML = '<div class="alert alert-error">Please enter your Student ID</div>';
        return; 
      }

      // Show loading state
      attendanceDiv.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading attendance data...</p></div>';

      fetch(`http://localhost:8081/student/${id}/attendance`)
      .then(response => {
        if (!response.ok) throw new Error("No attendance found for given ID");
        return response.json();
      })
      .then(data => {
        if (Array.isArray(data) && data.length > 0) {
          let html = '<div class="card" style="margin-top: 20px;"><h3 style="color: #2d3748; margin-bottom: 20px;">ğŸ“… Your Attendance Record</h3>';
          html += '<div class="grid grid-1" style="gap: 15px;">';
          
          data.forEach(attendance => {
            const percentage = attendance.attendancePercent || 0;
            const statusColor = percentage >= 80 ? '#38a169' : percentage >= 60 ? '#d69e2e' : '#e53e3e';
            const statusText = percentage >= 80 ? 'Excellent' : percentage >= 60 ? 'Good' : 'Needs Improvement';
            
            html += `
              <div class="card" style="padding: 20px; border-left: 4px solid ${statusColor};">
                <div class="grid grid-2 align-center">
                  <div>
                    <h4 style="margin: 0; color: #2d3748;">${attendance.studentName}</h4>
                    <p style="margin: 5px 0; color: #718096;">Student ID: ${id}</p>
                    <span style="background: ${statusColor}; color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">${statusText}</span>
                  </div>
                  <div class="text-right">
                    <span style="font-size: 2rem; font-weight: 700; color: ${statusColor};">${percentage}%</span>
                    <p style="margin: 0; color: #718096; font-size: 0.9rem;">Attendance Rate</p>
                  </div>
                </div>
                
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                  <div class="grid grid-3" style="gap: 15px; text-align: center;">
                    <div>
                      <div style="font-size: 1.2rem; font-weight: 600; color: #38a169;">âœ“</div>
                      <div style="font-size: 0.8rem; color: #718096;">Present</div>
                    </div>
                    <div>
                      <div style="font-size: 1.2rem; font-weight: 600; color: #e53e3e;">âœ—</div>
                      <div style="font-size: 0.8rem; color: #718096;">Absent</div>
                    </div>
                    <div>
                      <div style="font-size: 1.2rem; font-weight: 600; color: #d69e2e;">ğŸ“Š</div>
                      <div style="font-size: 0.8rem; color: #718096;">Overall</div>
                    </div>
                  </div>
                </div>
              </div>
            `;
          });
          
          html += '</div></div>';
          attendanceDiv.innerHTML = html;
        } else {
          attendanceDiv.innerHTML = '<div class="alert alert-info">ğŸ“… No attendance records found for this student ID.</div>';
        }
      })
      .catch(err => {
        attendanceDiv.innerHTML = `<div class="alert alert-error">âŒ ${err.message}</div>`;
      });
    }

    function goBack() { 
      window.location.href = "student.html"; 
    }

    // Auto-load if student ID is in session storage
    window.addEventListener('load', function() {
      const studentId = sessionStorage.getItem('studentId');
      if (studentId) {
        document.getElementById('studentId').value = studentId;
        loadAttendanceById();
      }
    });
  </script>
</body>
</html>
