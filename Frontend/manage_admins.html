<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Admins</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="fade-in">
      <!-- Header -->
      <div class="nav">
        <div class="nav-brand">ğŸ‘¨â€ğŸ’¼ Manage Admins</div>
        <div class="nav-links">
          <button onclick="loadAdmins()" class="btn btn-info">ğŸ”„ Refresh</button>
          <a href="add_admin.html" class="btn btn-success">â• Add Admin</a>
          <a href="admin_dashboard.html" class="btn btn-secondary">â¬… Dashboard</a>
        </div>
      </div>

      <!-- Admins List -->
      <div class="card">
        <h2>ğŸ“‹ Administrator Directory</h2>
        <div id="adminsList">
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading administrators...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load admins on page load
    window.onload = function() {
      loadAdmins();
    };

    function loadAdmins() {
      const container = document.getElementById('adminsList');
      container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading administrators...</p></div>';

      fetch("http://localhost:8081/admin/all")
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return response.json();
        })
        .then(admins => {
          displayAdmins(admins);
        })
        .catch(error => {
          console.error('Error loading admins:', error);
          container.innerHTML = `
            <div class="text-center p-4">
              <div class="alert alert-warning">
                <h3>âš ï¸ Unable to load administrators</h3>
                <p>This could be because:</p>
                <ul style="text-align: left; margin: 15px 0;">
                  <li>â€¢ Database connection issue: ${error.message}</li>
                  <li>â€¢ Server is not running</li>
                  <li>â€¢ API endpoint not available</li>
                </ul>
                <div class="grid grid-2" style="gap: 15px; margin-top: 20px;">
                  <button onclick="loadAdmins()" class="btn btn-info">ğŸ”„ Try Again</button>
                  <a href="add_admin.html" class="btn btn-success">â• Add Admin</a>
                </div>
              </div>
            </div>
          `;
        });
    }

    function displayAdmins(admins) {
      const container = document.getElementById('adminsList');
      
      if (!admins || admins.length === 0) {
        container.innerHTML = `
          <div class="text-center p-4">
            <div class="alert alert-info">
              <h3>ğŸ‘¨â€ğŸ’¼ No administrators found</h3>
              <p>Add the first administrator to get started.</p>
              <a href="add_admin.html" class="btn btn-success mt-3">â• Add First Admin</a>
            </div>
          </div>
        `;
        return;
      }

      let html = '<div class="grid grid-1" style="gap: 20px;">';
      admins.forEach(admin => {
        html += `
          <div class="card" style="padding: 20px;">
            <div class="grid grid-2 align-center">
              <div>
                <h3 style="margin-bottom: 10px; color: #2d3748;">${admin.name || 'N/A'}</h3>
                <p style="color: #718096; margin: 5px 0;">ğŸ“§ ${admin.email || 'N/A'}</p>
                <p style="color: #718096; margin: 5px 0;">ğŸ†” ID: ${admin.id}</p>
                <span style="background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 4px 8px; border-radius: 12px; font-size: 0.8rem;">Administrator</span>
              </div>
              <div class="text-right">
                <div class="grid grid-1" style="gap: 10px;">
                  <button onclick="editAdmin(${admin.id})" class="btn btn-warning">âœï¸ Edit</button>
                  <button onclick="deleteAdmin(${admin.id}, '${admin.name || 'Admin'}')" class="btn btn-danger">ğŸ—‘ï¸ Delete</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      container.innerHTML = html;
    }

    function deleteAdmin(id, name) {
      if (confirm(`Are you sure you want to delete administrator "${name}"?\n\nWarning: This action cannot be undone!`)) {
        fetch(`http://localhost:8081/admin/${id}`, { 
          method: "DELETE" 
        })
        .then(response => response.text())
        .then(result => {
          alert('âœ… ' + result);
          loadAdmins(); // Refresh the list
        })
        .catch(error => {
          alert('âŒ Error deleting admin: ' + error.message);
        });
      }
    }

    function editAdmin(id) {
      alert('âœï¸ Edit functionality will be implemented soon!');
    }
  </script>
</body>
</html>