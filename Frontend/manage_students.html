<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Manage Students</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="fade-in">
      <!-- Header -->
      <div class="nav">
        <div class="nav-brand">ğŸ‘¨â€ğŸ“ Manage Students</div>
        <div class="nav-links">
          <button onclick="loadStudents()" class="btn btn-info">ğŸ”„ Refresh</button>
          <button onclick="showAddForm()" class="btn btn-success">â• Add Student</button>
          <a href="admin_dashboard.html" class="btn btn-secondary">â¬… Dashboard</a>
        </div>
      </div>

      <!-- Add Student Form (Hidden by default) -->
      <div id="addStudentForm" class="card hidden slide-up">
        <h2>â• Add New Student</h2>
        <div class="grid grid-2">
          <div class="form-group">
            <input type="text" id="studentName" placeholder="ğŸ‘¤ Full Name" class="form-control">
          </div>
          <div class="form-group">
            <input type="email" id="studentEmail" placeholder="ğŸ“§ Email Address" class="form-control">
          </div>
          <div class="form-group">
            <input type="text" id="studentDepartment" placeholder="ğŸ¢ Department" class="form-control">
          </div>
          <div class="form-group">
            <input type="text" id="studentId" placeholder="ğŸ†” Student ID" class="form-control">
          </div>
        </div>
        <div class="form-group">
          <input type="password" id="studentPassword" placeholder="ğŸ”’ Password" class="form-control">
        </div>
        
        <div class="grid grid-2" style="gap: 15px;">
          <button onclick="addStudent()" class="btn btn-success">âœ… Add Student</button>
          <button onclick="hideAddForm()" class="btn btn-danger">âŒ Cancel</button>
        </div>
        
        <div id="addMessage" class="mt-3"></div>
      </div>

      <!-- Students List -->
      <div class="card">
        <h2>ğŸ“‹ Student Directory</h2>
        <div id="studentsList">
          <div class="loading">
            <div class="spinner"></div>
            <p>Loading students...</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load students on page load
    window.onload = function() {
      loadStudents();
    };

    function loadStudents() {
      const container = document.getElementById('studentsList');
      container.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading students...</p></div>';

      fetch('http://localhost:8081/admin/list-students')
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          return response.json();
        })
        .then(students => {
          displayStudents(students);
        })
        .catch(error => {
          console.error('Error loading students:', error);
          container.innerHTML = `
            <div class="text-center p-4">
              <div class="alert alert-warning">
                <h3>âš ï¸ No students available to manage</h3>
                <p>This could be because:</p>
                <ul style="text-align: left; margin: 15px 0;">
                  <li>â€¢ No students have been added to the system yet</li>
                  <li>â€¢ Students register themselves through the student signup page</li>
                  <li>â€¢ Database connection issue: ${error.message}</li>
                </ul>
                <div class="grid grid-2" style="gap: 15px; margin-top: 20px;">
                  <button onclick="loadStudents()" class="btn btn-info">ğŸ”„ Try Again</button>
                  <button onclick="showAddForm()" class="btn btn-success">â• Add First Student</button>
                </div>
              </div>
            </div>
          `;
        });
    }

    function displayStudents(students) {
      const container = document.getElementById('studentsList');
      
      if (!students || students.length === 0) {
        container.innerHTML = `
          <div class="text-center p-4">
            <div class="alert alert-info">
              <h3>ğŸ“š No students found</h3>
              <p>Students can register themselves or you can add them manually.</p>
              <button onclick="showAddForm()" class="btn btn-success mt-3">â• Add First Student</button>
            </div>
          </div>
        `;
        return;
      }

      let html = '<div class="grid grid-1" style="gap: 20px;">';
      students.forEach(student => {
        html += `
          <div class="card" style="padding: 20px;">
            <div class="grid grid-2 align-center">
              <div>
                <h3 style="margin-bottom: 10px; color: #2d3748;">${student.name || 'N/A'}</h3>
                <p style="color: #718096; margin: 5px 0;">ğŸ“§ ${student.email || 'N/A'}</p>
                <p style="color: #718096; margin: 5px 0;">ğŸ¢ ${student.department || 'N/A'}</p>
                <p style="color: #718096; margin: 5px 0;">ğŸ†” ID: ${student.id}</p>
              </div>
              <div class="text-right">
                <div class="grid grid-1" style="gap: 10px;">
                  <button onclick="editStudent(${student.id})" class="btn btn-warning">âœï¸ Edit</button>
                  <button onclick="deleteStudent(${student.id}, '${student.name || 'Student'}')" class="btn btn-danger">ğŸ—‘ï¸ Delete</button>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      html += '</div>';
      
      container.innerHTML = html;
    }

    function showAddForm() {
      document.getElementById('addStudentForm').classList.remove('hidden');
      document.getElementById('addStudentForm').scrollIntoView({ behavior: 'smooth' });
    }

    function hideAddForm() {
      document.getElementById('addStudentForm').classList.add('hidden');
      clearAddForm();
    }

    function clearAddForm() {
      document.getElementById('studentName').value = '';
      document.getElementById('studentEmail').value = '';
      document.getElementById('studentDepartment').value = '';
      document.getElementById('studentId').value = '';
      document.getElementById('studentPassword').value = '';
      document.getElementById('addMessage').innerHTML = '';
    }

    function addStudent() {
      const data = {
        name: document.getElementById('studentName').value,
        email: document.getElementById('studentEmail').value,
        department: document.getElementById('studentDepartment').value,
        studentId: document.getElementById('studentId').value,
        password: document.getElementById('studentPassword').value
      };

      const messageDiv = document.getElementById('addMessage');

      if (!data.name || !data.email || !data.password) {
        messageDiv.innerHTML = '<div class="alert alert-error">Please fill in all required fields</div>';
        return;
      }

      messageDiv.innerHTML = '<div class="alert alert-info">ğŸ”„ Adding student...</div>';

      fetch('http://localhost:8081/admin/add-student', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(response => response.text())
      .then(result => {
        if (result.includes('successfully')) {
          messageDiv.innerHTML = '<div class="alert alert-success">âœ… ' + result + '</div>';
          clearAddForm();
          loadStudents(); // Refresh the list
          setTimeout(hideAddForm, 2000); // Hide form after 2 seconds
        } else {
          messageDiv.innerHTML = '<div class="alert alert-error">âŒ ' + result + '</div>';
        }
      })
      .catch(error => {
        messageDiv.innerHTML = '<div class="alert alert-error">âŒ Error: ' + error.message + '</div>';
      });
    }

    function deleteStudent(id, name) {
      if (confirm(`Are you sure you want to delete student "${name}"?`)) {
        fetch(`http://localhost:8081/admin/delete-student/${id}`, {
          method: 'DELETE'
        })
        .then(response => response.text())
        .then(result => {
          alert('âœ… ' + result);
          loadStudents(); // Refresh the list
        })
        .catch(error => {
          alert('âŒ Error deleting student: ' + error.message);
        });
      }
    }

    function editStudent(id) {
      alert('âœï¸ Edit functionality will be implemented soon!');
    }
  </script>
</body>
</html>